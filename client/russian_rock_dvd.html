<!doctype html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <title>Прокат кассет и DVD</title>
        <link rel="icon" type="image/png" href="img/cassette_logo.png">
    </head>
    <body>
        <header>
            <div class="header_bar">
                <div class="wrapper">
                    <div class="header_bar_suitacase">
                        <div class="header_bar_left">
                            <ul class="header_bar_ul">
                            <li><a href="main.html">
                            <span>ГЛАВНАЯ</span></a>
                            </li>
                            <li><a href="cassettes.html"><span>КАССЕТЫ</span></a>
                            </li>
                            <li><a href="dvds.html"><span>DVD</span></a></li>
                            </ul>
                        </div>
                        <div class="header_bar_right">
                            <div class="header_bar_cart">
                                <a href="/cart" class="cart-but">
                                <span class="cart-icon"><img src="img/cart.png" /></span>
                                 Корзина 
                                <span class="cart-count">0</span>
                                </a>
                            </div>


                            <div class="header_bar_search">
                                <form action="/search" method="get" class="header_bar_search_form" role="search">
                                    <input type="search" name="q" value="" class="header_bar_search_input">
                                    <button type="submit" class="header_bar_search_btn">
                                        <img src="img/loupe_small.png"/>
                                    </button>
                                </form>
                            </div> 
                        </div>   
                    </div>
                </div>
            </div>
        </header>
        <main class="main_page">

            <div class="popup-bg">
              <div class="popup">
                <a class="close-popup-a"><img class="close-popup" src="img/close.png" alt=""></a>
                <div class="alb">
                    <div class="info" id="dvd_info"></div>
                    <div class="addit_info" id="dvd_addit_info"></div>
                </div>
              </div>
            </div>

            <nav class="main-page-cassettes">
                <div class="main-list-cassettes">
                    
                </div>
            </nav>


        </main>
        <footer class="main_page_footer">
            <div class="wrapper">
                <div class="main_page_footer_grid">
                    <div class="grid_item_footer">
                        <h4>Полезные ссылки</h4>
                    </div>
                </div>
            </div>
        </footer>   

        <script>

            $('.main-list-cassettes').on('click', '.img_win' , function(){
                $('.info').empty();
                $('.addit_info').empty();
                $('.popup-bg').fadeIn(800);
                $('html').addClass('no-scroll');
                var alb_name = $(this).prev().text();
                var object;
                $.getJSON("goods.json", function(objects){
                    for (var i = objects.length-1; i >= 0; i--){
                        if (objects[i].name == alb_name){
                            object = objects[i];
                            console.log(object.name);
                        }
                    }
                    var html = $('<img class="dvd_cover_win" src="' + object.img_path + '"/>' + '<span class="name_win">' + object.name + '</span>' + '<span class="group_win">' + object.group + '</span>');
                    var html_l = $('<div class="track_list">' + '</div>');
                    var html_r = $('<div class="img_list">' + '</div');
                    $('.info').append(html);
                    $('.addit_info').append(html_l);
                    $('.addit_info').append(html_r);
                    $('.track_list').append($('<span class="beg_tracks">Треклист</span>'));
                    $('.track_list').append($('<ul class="tracks">' + '</ul>'));
                    
                    for (var i = 0; i < object.track_list.length; i++){
                        var j = i + 1;
                        console.log(object.track_list[i]);
                        var html_el = $('<li class="dvd_track">' + String(j) + ') ' +  object.track_list[i] + '</li>');
                        $('.tracks').append(html_el);
                    }
                    
                    for (var i = 0; i < object.img_list.length; i++){
                        var html_el = $('<img class="dvd_alb_img" src = "' + object.img_list[i] + '"' + '/>');
                        $('.img_list').append(html_el);
                    }

                });

            });

            $('.close-popup-a').click(function(){
                $('.popup-bg').fadeOut(800);
                $('html').removeClass('no-scroll');
            });


            $("#btn_1").click(function(){
                $('.main-list-cassettes').empty();
                var arr = [];
                var request = $(".header_bar_search_input").val();
                if (request != ""){
                    $.getJSON("goods.json", function (objects) {
                        for (var i = objects.length-1; i >= 0; i--){
                            if (objects[i].group == request){
                                arr.push(objects[i]);
                                console.log(arr);
                            }
                        }
                        main(arr);   
                    });
                }
            });
            
            var rend_elements = function(objs){
                if (objs.genre == "Rus_Rock" && objs.type == "DVD"){
                    var html = $('<li class="main-list-cassettes-element">' + '<span class="main-list-cassettes-element-name">' + objs.name + '</span>' + '<a class="img_win">' +'<img class="main-list-cassettes-element-img" src="' + objs.img_path + '"/>' + '</a>' + '<span class="main-list-cassettes-element-price">' + objs.price + '</span>' + '<button class="main-list-cassettes-element-btn">Добавить</button>' + '</li>');
                    $('.main-list-cassettes-container').append(html);
                }
            }

            var main = function(objects){
                "use strict";
                $('.main-list-cassettes').append('<ul class="main-list-cassettes-container"></ul>');

                for (var i = objects.length-1; i >= 0; i--){
                    rend_elements(objects[i]);
                }
            }
            
           $(document).ready(function(){
                $.getJSON("goods.json", function (objects) {
                    main(objects);   
                });
            });

        </script>

    </body>
</html>